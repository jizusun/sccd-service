Status: OK
Time Taken: 63
Size: 8470
Timestamp: Mon Nov 04 07:48:47 UTC 2019
TestStep: Register

----------------- Messages ------------------------------

----------------- Properties ------------------------------
HTTP Version: HTTP/1.1
Endpoint: https://go-dgq5qdz5dm.dispatcher.int.sap.eu2.hana.ondemand.com/xsearch//
Username: 
Encoding: 
Method: GET
StatusCode: 200
URL: https://go-dgq5qdz5dm.dispatcher.int.sap.eu2.hana.ondemand.com/xsearch//
Password: 

---------------- Request ---------------------------
Cookie: [_pk_id.cd0ce735-ce82-4b83-b008-f1006fcaddde.4b40=8c32825861bc6d3f.1562055286.0.1565947609..; _swa_ref.cd0ce735-ce82-4b83-b008-f1006fcaddde.4b40=%5B%22%22%2C%22%22%2C1565946677%2C%22https%3A%2F%2Fgo-dgq5qdz5dm.dispatcher.int.sap.eu2.hana.ondemand.com/xsearch/%22%5D;oucrspiwgnpzqlctsbkxvqzci=TNYi5Ez66lfYkLsE7nzuDLovEEZQFn%2F8vnxvNLXzNqHg776%2F4CtL8gVRVjkjpEunES9mfo8r88Ceo5YkysicdsYDCleqIu0kS8AC7GGlPdp59%2Bq%2Blt7G6VxlY5KqsvvLkx5hj6BLgs2YSKwlf2KvR3c8GvAtAcZQEdhhArtNnxmMz%2F6Gx9CX0gaFHnWBEoaB7cHknrdRPC%2BTa1GZKGJJyUwICG%2FVSIfSroXneZIkUMDOCrJbhSwqn548XuT%2FudbBoVcdjBc0XsnUQEIAcxBVjC%2Fz1WRV77%2Bq9JKk%2BvZHvivgi%2BP54kX%2F7uLXx9UclbJqYwN9h9zMpRkoo%2BbaTB5XD7eGRFTZMLfVi6%2F7yWWH35CgfRQ5E%2F7k9WUHqvpBE8NkeCb6TNtA%2FUcRPWn96e9etw%3D%3D; BIGipServerdispatcher.int.sap.eu2.hana.ondemand.com=!KgssOzRWF4KNXYrm5e9QtIhWtwkpHl/8HmIcFS4WapqRGEQ06SJijYDtyuxXv8JxHsg/kyB4Bk4eMA==;XSRF_COOKIE=B++/vSLvv73vv70vdu+/ve+/vXTvv71577+977+977+9YO+/vRE4De+/ve+/vUc0Ye+/vVhd77+9f++/vToxNTcyODUzNzI3MTkw;JSESSIONID=89B4073042ED7266E92F1AAFC7DFD6EB;;XSRF_COOKIE=B++/vSLvv73vv70vdu+/ve+/vXTvv71577+977+977+9YO+/vRE4De+/ve+/vUc0Ye+/vVhd77+9f++/vToxNTcyODUzNzI3MTkw;JSESSIONID=89B4073042ED7266E92F1AAFC7DFD6EB;, BIGipServerdispatcher.int.sap.eu2.hana.ondemand.com=!KgssOzRWF4KNXYrm5e9QtIhWtwkpHl/8HmIcFS4WapqRGEQ06SJijYDtyuxXv8JxHsg/kyB4Bk4eMA==; oucrspiwgnpzqlctsbkxvqzci=TNYi5Ez66lfYkLsE7nzuDLovEEZQFn%2F8vnxvNLXzNqHg776%2F4CtL8gVRVjkjpEunES9mfo8r88Ceo5YkysicdsYDCleqIu0kS8AC7GGlPdp59%2Bq%2Blt7G6VxlY5KqsvvLkx5hj6BLgs2YSKwlf2KvR3c8GvAtAcZQEdhhArtNnxmMz%2F6Gx9CX0gaFHnWBEoaB7cHknrdRPC%2BTa1GZKGJJyUwICG%2FVSIfSroXneZIkUMDOCrJbhSwqn548XuT%2FudbBoVcdjBc0XsnUQEIAcxBVjC%2Fz1WRV77%2Bq9JKk%2BvZHvivgi%2BP54kX%2F7uLXx9UclbJqYwN9h9zMpRkoo%2BbaTB5XD7eGRFTZMLfVi6%2F7yWWH35CgfRQ5E%2F7k9WUHqvpBE8NkeCb6TNtA%2FUcRPWn96e9etw%3D%3D]
Cookie2: [$Version=1]
Referer: [https://authn.int.sap.eu2.hana.ondemand.com/saml2/sp/acs/dgq5qdz5dm/dgq5qdz5dm]
Connection: [Keep-Alive]
User-Agent: [Apache-HttpClient/4.1.1 (java 1.5)]
Host: [go-dgq5qdz5dm.dispatcher.int.sap.eu2.hana.ondemand.com]
Accept-Encoding: [gzip,deflate]
Content-Length: [6735]
Content-Type: [application/x-www-form-urlencoded]

---------------- Response --------------------------
Strict-Transport-Security: [max-age=31536000; includeSubDomains; preload]
Server: [SAP]
ETag: ["af2307f9437cdae60a02dcd79f3fcd206d49fedb"]
Vary: [Accept-Encoding]
#status#: [HTTP/1.1 200 ]
Content-Length: [8470]
Date: [Mon, 04 Nov 2019 07:48:47 GMT]
Content-Type: [text/html]

<!DOCTYPE HTML>
<html>
	<head>
		<title>SAP xSearch</title>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" />
		
		<style>
			#busyIndicator { margin-top:8em; text-align:center; color:#555555 }
			.sapMPage>section { height:100% }
		</style> 
		 
		<!-- load the commons lib "sap.ui.commons" and the "sap_belize" theme -->
		<script src="https://sapui5.hana.ondemand.com/1.54.6/resources/sap-ui-core.js"
			id="sap-ui-bootstrap" 
			data-sap-ui-theme="sap_belize"
			data-sap-ui-preload="async"
			data-sap-ui-language="en"  
			data-sap-ui-libs="sap.m,sap.ui.layout"
			data-sap-ui-xx-bindingSyntax="complex">
		</script>
		
		<script>	
		    var swa = false;
			// Register platform module path as local resource
			jQuery.sap.registerModulePath("sap.support.engineersearch", "./");
		
		    // Handle Cloud Session Management
			(function(){

				var onReload = function(){
					//Open a new tab to reconnect xsearch app
					sap.m.URLHelper.redirect("./Reconnect.html", true);
					
					timeoutDialog.close();
				};

				var onOK = function(){
					timeoutDialog.close();
				};

				jQuery.sap.require('sap.ui.core.Fragment');//Need this to load sap.ui.xmlfragment info
				var timeoutDialog = sap.ui.xmlfragment("", "sap.support.engineersearch.view.dialogs.requesterror.SessionTimeoutDialog", {onReload:onReload, onOK:onOK});

				var showTimeoutDialog = function(){
					if(!timeoutDialog.isOpen()){
						timeoutDialog.open();
					}
					jQuery.sap.log.debug("Session timeout dialog shows up.", "", "SessionTimeoutIn24H");
				};

				var handleSessionTimeout = function(){
					showTimeoutDialog();

					jQuery.sap.clearDelayedCall(onSessionTimeout);
					jQuery.sap.clearDelayedCall(extendSession);
					jQuery.sap.log.debug("Clean up all session timers because of session timeout dialog shows up.", "", "SessionTimeoutIn24H");
				};

				// Part 1.1-JSON model(session expires after 20 minutes(defined in server side) of no request to server)
				// https://help.sap.com/viewer/65de2977205c403bbc107264b8eccf4b/Cloud//e637f62abb571014857cb0232adc43a7.html#loio6ad764f643bb401d8a50529afb1d17b3
				// Only can track JSON model's timeout
				jQuery(document).ajaxComplete(function(oEvent, oXHR, ajaxOptions ) {
					if(oXHR.getResponseHeader('com.sap.cloud.security.login')==='login-request'){
						handleSessionTimeout();
					}
				});

				// Part 1.2-oDta model(session expires after 20 minutes(defined in server side) of no request to server)
				var checkStatus = function(mArguments){
					// PAY ATTENSION: Only oData model has header info
					if(mArguments && mArguments.response && mArguments.response.headers && mArguments.response.headers['com.sap.cloud.security.login'] === 'login-request'){
						handleSessionTimeout();
						return;
					}

					// In theory, this block should be executed after ajaxComplete and fireRequestCompleted.
					// Should refactor: Jojo Feng
					// Start ....
					if(!timeoutDialog.isOpen()){//No need to maintain timers after timeout dialog shows up.
						sessionExtend();//Reset session life on every remote call finishes
						checkSessionHeartbeat(mArguments === null ? null : mArguments.url);
					}
					// End.
				};

				jQuery.sap.require('sap.ui.model.Model');
				var fnOriginalFireRequestCompleted = sap.ui.model.Model.prototype.fireRequestCompleted;
				// Override fireRequestCompleted, adding session status check before every requestCompleted event firedï¼›
				// both JSONModel and ODataModel will be impacted.
				// For cannot get mArguments.response.headers of JSONModel, so did Part 1.1; otherwise we can remove it.
				sap.ui.model.Model.prototype.fireRequestCompleted = function(mArguments) {
					if(typeof checkStatus === "function"){
						checkStatus.call(this, mArguments);
					}

					return fnOriginalFireRequestCompleted.call(this, mArguments);
				};

				// Part 2(session expires after 20 minutes of inactivity)
				var sessionLifetime = 20*60*1000, onSessionTimeout;
				var sessionExtend = function() {
					jQuery.sap.clearDelayedCall(onSessionTimeout);
					onSessionTimeout = jQuery.sap.delayedCall(sessionLifetime, this, handleSessionTimeout);
				};
				sessionExtend();
				jQuery(document).mousedown(sessionExtend).keydown(sessionExtend);

				//Fake session time to be 24h by sending heartbeat package to back-end server every 15 minutes
				//We will send out heartbeat request after ervery 15 inactive minutes.
				var maxSessionTime = 864e5,
					heartbeatInterval = 15 * 60 * 1000,
					extendSession;

				var firstInactiveTime;
				var updateFirstInactiveTime = function (sTargetURL) {
					if (isSessionHeartbeat(sTargetURL)) {
						//If it is during heartbeat maintenance, no need to reset the start time of inactive.
						jQuery.sap.log.debug("Got response of heartbeat request " + sTargetURL, "", "SessionTimeoutIn24H");
						return;
					}

					firstInactiveTime = new Date();
					jQuery.sap.log.debug("First inactive timestamp is updated: " + firstInactiveTime + ".", "", "SessionTimeoutIn24H");
				};

				var isSessionHeartbeat = function (sUrl){
					return sUrl != null && sUrl.indexOf("SessionHeartbeat.json") !== -1;
				};

				var checkSessionHeartbeat = function (sTargetURL) {
					updateFirstInactiveTime(sTargetURL);

					jQuery.sap.clearDelayedCall(extendSession);//Clear if it already exists, and start new heart beat check
					extendSession = jQuery.sap.delayedCall(heartbeatInterval, this, sendHeartbeatRequest);
					jQuery.sap.log.debug("Session heartbeat request is scheduled to be sent out in " + new Date((new Date()).getTime() + heartbeatInterval), "", "SessionTimeoutIn24H");
				};

				var heartbeatModel = new sap.ui.model.json.JSONModel("./model/SessionHeartbeat.json", false);//Cannot define an empty JSON model, which will throw out an exception: parse error
				var sendHeartbeatRequest = function() {
					if (((new Date()).getTime() - firstInactiveTime) >= (maxSessionTime - (sessionLifetime - heartbeatInterval))) {
						//If current total inactive time is almost beyond maximum session duration time,
						//then we should stop the named "last" heartbest check,
						//ending all of the heartbeat checks.
						jQuery.sap.clearDelayedCall(extendSession);
						jQuery.sap.log.debug("Terminate all the session heartbeat requests for it exceeds maximum maintenance time of " + (maxSessionTime - (sessionLifetime - heartbeatInterval)) / 1000 / 60 + " minutes.", "", "SessionTimeoutIn24H");
						return;
					}

					//Sendout heartbeat request
					heartbeatModel.loadData("./model/SessionHeartbeat.json", "", true, "GET", false, false); //No cache
					jQuery.sap.log.debug("Sent out session heartbeat request.", "", "SessionTimeoutIn24H");
				};
			})();

			// Create the tools page and place it at the content
			sap.ui.getCore().attachInit(function () {
				sap.ui.require([
					"sap/ui/core/ComponentContainer"
				], function (ComponentContainer) {
					// initialize the UI component
					new ComponentContainer({
						height: "100%", name: "sap.support.engineersearch",
						settings: { id: "EngineerSearchContainer" }
					}).placeAt("content");
				});
			});
			
			//WARP/SWA set up
			var swaDelayed = [], swaDelay = function(sFunction, oArguments) {
				swaDelayed.push({ name: sFunction, arguments: oArguments });
			}, swa = {
				pubToken: 'cd0ce735-ce82-4b83-b008-f1006fcaddde',	//launchpad fallback
				baseUrl: 'https://webanalytics.cfapps.eu10.hana.ondemand.com/tracker/',
				visitorCookieTimeout: 63113852,
				dntLevel: 1,
				bannerEnabled: false,
				custom1: {ref: "engineersearch", isStatic:true},
				trackLoad: function() { swaDelay('trackLoad', arguments); },
				trackCustomEvent: function() { swaDelay('trackCustomEvent', arguments); }
			};
			if(window.location.hostname==='go.support.sap.com')
				swa.pubToken = '594f61a0-09d3-7840-adbc-bc5e05ce5168';	//other applications/mobile
			(function(){
				var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
				g.type='text/javascript'; g.defer=true; g.async=true; g.src=swa.baseUrl+'js/privacy.js';
				s.parentNode.insertBefore(g,s);
			})();
		</script>
	</head>
	
	<body class="sapUiBody" id="content" role="application">
		<div id="busyIndicator">Loading ...</div>
	</body>
</html>
